# سياسة المنتج والحوكمة والتوزيع (نسخة عملية)

هذا المستند يوضح كيف تجعل المنتج «مملوكًا للشركة» وقابلًا للإدارة مثل منتجات الشركات.

## 1) حقيقة مهمة

لا يوجد حل تقني يعطي **منعًا مطلقًا 100%** من النسخ إذا كان المهاجم يملك وصولًا إداريًا كاملًا للجهاز.
لكن يمكن تطبيق طبقات قوية تجعل النسخ غير عملي تجاريًا:

1. تفعيل مرتبط بالجهاز (Device Binding)
2. مفاتيح تفعيل مركزية بيد الشركة فقط
3. تحقق دوري من الترخيص عبر الخادم
4. تعطيل الترخيص عن بعد عند إساءة الاستخدام
5. عقود قانونية + شروط ترخيص

## 2) ما تم تطبيقه فعليًا في الكود

- نقطة تفعيل: `POST /installations/activate`
- نقطة تحقق: `POST /installations/validate`
- جدول `installations` لحصر الأجهزة المرخّصة
- ترخيص JWT موقّع ومربوط بـ `device_id`
- التطبيق المكتبي لا يكمل بدون ترخيص صالح

## 3) سياسة توزيع صارمة

1. لا تسلّم الشيفرة المصدرية للعميل.
2. سلّم فقط Installer موقّع (Code Signing).
3. كل جهاز جديد:
   - يرسل `device_id`
   - تحصل على تفعيل من فريق الشركة فقط
4. عند انتهاء عقد عميل أو مخالفة:
   - عطل الجهاز من جدول `installations` (is_active=false)

## 4) سياسة إدارة الإصدارات (Professional Release)

1. **Semantic Versioning**
   - MAJOR.MINOR.PATCH
2. **Branching Strategy**
   - `main` للإنتاج
   - `develop` للتطوير
   - `release/*` للتجهيز
   - `hotfix/*` للطوارئ
3. **Git Tags**
   - كل إصدار يحمل tag (مثل `v0.2.0`)
4. **Release Notes**
   - ماذا تغيّر؟
   - أي مشاكل معروفة؟
   - خطوات الترقية

## 5) سياسة الصيانة والتحديث

- اعتماد إعدادات مركزية من `.env`
- اختبار smoke قبل كل Release
- توثيق تغييرات DB قبل النشر
- تفعيل نسخ احتياطي يومي + اختبار استعادة

## 6) الخطوات التالية للوصول لمستوى أعلى

1. إضافة Alembic migrations بدل `create_all`
2. CI/CD (Lint + Tests + Build + Tag)
3. تغليف العميل كـ installer (MSI/EXE) مع Code Signing
4. Remote kill-switch/heartbeat للترخيص
5. تشفير أسرار العميل باستخدام OS keyring
